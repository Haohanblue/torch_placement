# Minecraft 最少火把布置问题 - 算法实现与评估

本项目旨在对“Minecraft 最少火把布置”问题进行建模、实现多版求解算法，并开展可复现的实验评估。

## 1. 问题建模

### 1.1 场景与光照机制

- **三维网格**：世界被抽象为一个 `M × N × H` 的三维网格，每个方块为 `Solid`（实心）或 `Air`（空气）。
- **光源与传播**：
    - 火把被视为一个方块光源，其源光照等级 (L₀) 为 14。
    - 光在空气中以三维曼哈顿距离（6 邻接）传播，每移动一格，光照等级衰减 1。
    - `Solid` 方块会完全阻挡光线传播。
- **安全阈值**：
    - 根据 Minecraft 1.18+ 版本，敌对生物仅在光照等级为 0 的方块上刷新。
    - 因此，我们定义一个方块是“安全”的，当且仅当其接收到的 `block_light >= 1`。

### 1.2 任务定义

- **需覆盖点集 `U`**：
    - **`all_air` 模式**（默认）：所有 `Air` 方块都必须被照亮。
    - **`ground2` 模式**（可选）：更贴近刷怪空间，只考虑那些“下方是 `Solid` 方块，且自身与上方一格都是 `Air`”的区域。
- **火把候选 `C`**：
    - 一个火把可以放置在任何 `Solid` 方块的顶面或侧面（N/S/E/W），只要其自身所占据的相邻空间是 `Air`。
- **目标**：
    - 从所有候选 `C` 中，选择一个规模最小的子集 `S`。
    - 使得对 `U` 中所有的点 `p`，都有 `max_{t ∈ S} L_t(p) >= 1`，即 `U` 中所有点都被照亮。

## 2. 算法实现

本项目实现了三个版本的算法来解决该问题，该问题本质上是一个 **0-1 集合覆盖问题**（Set Cover Problem）。

- **A. 精确版 (`exact.py`)**
    - **方法**：将问题转化为位图表示的集合覆盖，使用**回溯搜索与分支限界**（Backtracking with Pruning）求解。
    - **特点**：保证找到最优解，但仅在小规模地图（如 `20x20x3`）上可行。
- **B. 贪心版 (`greedy.py`)**
    - **方法**：经典的**贪心集合覆盖算法**。在每一步迭代中，选择那个能覆盖最多“尚未安全”的点的火把。
    - **特点**：速度快，可扩展到中大规模，但解不保证最优。
- **C. 改进版 (`improve.py`)**
    - **方法**：在贪心解的基础上进行两阶段后处理优化。
        1. **冗余删除**：逐一检查已选火把，如果移除后所有点仍然安全，则永久移除该火把。
        2. **1-交换（可选）**：尝试用一个未使用的火把替换一个已选火-把，若能保持完全覆盖，则执行交换。为保证效率，此步骤仅在小图上启用，并限制迭代次数。

## 3. 代码结构

```
torch_placement/
├── mc_light/                # 核心逻辑模块
│   ├── algorithms/          # 算法实现 (exact, greedy, improve)
│   ├── eval/                # 评估与制图 (evaluate, charts)
│   ├── grid.py              # 三维网格与方块类型
│   ├── light.py             # BFS 光照传播模拟
│   ├── candidates.py        # 火把候选生成
│   ├── universe.py          # 需覆盖点集 U 的构建
│   └── maps.py              # 测试地图生成器
├── output/                  # 实验输出
│   ├── charts/              # PNG 图表
│   ├── results_table.csv    # 详细数据
│   └── summary.json         # JSON 格式数据
└── README.md
```

## 4. 运行与评估

### 4.1 依赖

- Python 3.8+
- NumPy
- Matplotlib

```bash
pip install numpy matplotlib
```

### 4.2 运行实验

直接执行 `evaluate.py` 脚本即可启动完整的评估流程。

```bash
python -m torch_placement.mc_light.eval.evaluate
```

脚本会自动执行以下步骤：
1. **生成测试集**：为 `small`, `medium`, `large` 三种规模，以及 `corridor`, `rooms`, `cave` 三种地形生成固定的测试地图。
2. **运行算法**：
   - 在**小规模**地图上，运行**精确、贪心、改进**三种算法。
   - 在**中/大规模**地图上，运行**贪心、改进**两种算法。
3. **记录指标**：收集覆盖率、火把数量、相对最优差距（小图）、运行时间等指标。
4. **生成输出**：
   - 在 `output/` 目录下生成 `results_table.csv` 和 `summary.json` 数据文件。
   - 在 `output/charts/` 目录下生成对比图表（PNG 格式），包括：
     - 各算法火把数量对比。
     - 各算法运行时间对比。
     - 小规模地图上的近似差距分析。

所有输出文件路径均为相对路径，方便查阅与复现。
